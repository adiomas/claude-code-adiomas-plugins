# Parallelization Configuration Reference

This document describes the parallelization settings available in autonomous-dev.

## Configuration Location

Add parallelization settings to `.claude/auto-context.yaml`:

```yaml
# .claude/auto-context.yaml

# ... other settings ...

parallelization:
  # Master switch - enable/disable parallel execution
  enabled: true

  # Minimum independent tasks to trigger parallelization
  # If fewer independent tasks found, use sequential execution
  min_tasks: 3

  # Maximum concurrent agents
  # Limits resource usage and prevents context overflow
  max_agents: 5

  # Minimum task complexity to parallelize
  # Options: "small", "medium", "large"
  # "small" tasks may not benefit from parallelization overhead
  min_complexity: "small"

  # Automatically clean up worktrees after successful merge
  auto_cleanup: true

  # Number of times to retry a failed agent before marking as failed
  retry_on_failure: 3

  # Integration validation before merge
  require_integration_validation: true
```

## Full Configuration Template

Copy this template to your project's `.claude/auto-context.yaml`:

```yaml
# Autonomous Development Context
# Generated by autonomous-dev plugin

session:
  id: "auto-{timestamp}"
  started_at: "2026-01-17T00:00:00Z"
  status: pending

work_type: FRONTEND  # or BACKEND, FULLSTACK, etc.

# Parallelization settings
parallelization:
  # Enable/disable parallel execution
  enabled: true

  # Thresholds
  min_tasks: 3        # Minimum independent tasks to trigger
  max_agents: 5       # Maximum concurrent agents
  min_complexity: "small"  # Minimum task size: small, medium, large

  # Behavior
  auto_cleanup: true          # Remove worktrees after merge
  retry_on_failure: 3         # Retry count for failed agents
  require_integration_validation: true  # Run integration-validator before merge

  # Advanced
  worktree_base: "/tmp/auto-worktrees"  # Base path for worktrees
  branch_prefix: "auto/"                # Prefix for parallel branches

# Skill chain configuration
skill_chains:
  frontend:
    auto_invoke_decomposer: true
    auto_invoke_parallel: true
    min_components: 3

  backend:
    auto_invoke_decomposer: true
    auto_invoke_parallel: true
    min_endpoints: 3

  fullstack:
    auto_invoke_decomposer: true
    auto_invoke_parallel: true
    parallel_layers: true  # Backend + frontend in parallel

# Override settings (optional)
overrides:
  skip_decomposer: false    # Force skip task decomposition
  skip_parallel: false      # Force sequential execution
  force_parallel: false     # Force parallel even with < min_tasks
```

## Per-Project Overrides

Override parallelization for specific project types:

### Small Projects (< 10 files)

```yaml
parallelization:
  enabled: false  # Overhead not worth it
```

### Large Monorepos

```yaml
parallelization:
  enabled: true
  max_agents: 8        # More agents for larger repos
  min_tasks: 5         # Higher threshold
  auto_cleanup: false  # Keep worktrees for debugging
```

### CI/CD Environments

```yaml
parallelization:
  enabled: true
  max_agents: 3        # Limited resources
  auto_cleanup: true   # Clean up after
  retry_on_failure: 1  # Fail fast
```

## Environment Variables

Override config via environment variables:

```bash
# Disable parallelization
export AUTO_PARALLEL_ENABLED=false

# Set max agents
export AUTO_PARALLEL_MAX_AGENTS=3

# Set minimum tasks threshold
export AUTO_PARALLEL_MIN_TASKS=5
```

## Decision Logic

The parallelization decision follows this logic:

```
START
  │
  ▼
parallelization.enabled == true?
  │
  ├── NO ──▶ SEQUENTIAL
  │
  └── YES
        │
        ▼
      independent_tasks >= min_tasks?
        │
        ├── NO ──▶ SEQUENTIAL
        │
        └── YES
              │
              ▼
            max_agents reached?
              │
              ├── YES ──▶ PARALLEL (limited agents)
              │
              └── NO ──▶ PARALLEL (all tasks)
```

## Monitoring Parallelization

Check current parallelization status:

```bash
# View current config
yq '.parallelization' .claude/auto-context.yaml

# View state machine
yq '.current_state' .claude/auto-state-machine.yaml

# View progress
yq '.tasks' .claude/auto-progress.yaml
```

## Troubleshooting

### Parallelization not triggering

1. Check `parallelization.enabled` is `true`
2. Verify `independent_tasks >= min_tasks`
3. Check state machine is in correct state

### Too many agents causing issues

1. Reduce `max_agents` in config
2. Increase `min_tasks` threshold
3. Set `min_complexity: "medium"` to skip small tasks

### Worktrees not cleaning up

1. Check `auto_cleanup: true`
2. Manually clean: `git worktree prune`
3. Check for orphaned worktrees: `git worktree list`
